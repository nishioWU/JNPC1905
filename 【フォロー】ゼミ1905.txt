みなさま
    ▽西尾拝

　土曜日は、記者ゼミにご参加ありがとうございました。貴重な週末を使っての勉強会、お疲れさまでした。
　宇佐見さん・山本さん、事務局のみなさま、そして日本マイクロソフトのみなさま、企画段階から当日まで、何から何までお世話になりました。

　添付のExcelシートは、広瀬さんの講義のうち、男女の平均寿命の並び順を揃えるところまでを再現してみたものです。つまり、前半の勘どころのVLOOKUPと絶対参照だけに絞っています。大体スライドに沿っていますが、たまたま小生の環境ではVALUE関数を使わなくても数値に変換できたので（当日も同様の質問が出ていました）、ここでは使っていません。もちろん、環境によらず確実に動かすためには、VALUE関数を使った方がよいので、そこは手間との相談です。
　本番になかった部分では、見慣れた「都道府県コード順」に揃える方法を、シートの４枚目で紹介しています。また、列か行の片方だけを絶対参照にする使い方の例を、５枚目以降で紹介しています。
　おさらいに活用いただければ幸いです。


（０）ポイント＝シートの４枚目部分です

▶単に男女の並び順を揃えるだけでなく、見慣れた都道府県順にしたい
　あらかじめ、北海道、青森……沖縄、というデータ列を用意しておく。ネットからのコピペでもよい。
→Ｏ（オー）列

▶１～４７まで通し番号をつける。こうしておくと、たとえば女性の平均寿命の長い順にソートした後で、また元の順番に戻せる。通し番号の列を昇順にソートすればよい
→Ｎ列、Ｓ列

▶この都道府県名の列をキーにして、男性と女性の平均寿命を取ってくる。だから、VLOOKUPを使う列が、２列（男性＝Ｐ列、女性＝Ｑ列）必要

▶でも、数式を何度も打つのは面倒なので、男性の列の先頭のセル（P6）に入れた式を、女性の列にもドラッグして使い回したい。そこで、都道府県名の入ったＯ（オー）列や、探しに行く範囲がずれないよう、絶対参照を使う
→=VLOOKUP($O6, $H$6:$I$53, 2, FALSE)
この「$O6」の最初の$がＯ列固定の意味、次の「$H$6:$I$53」の$が探しに行く範囲を列・行とも固定の意味

▶下にコピーして増やした際に、行のほうは、スライドして行ってくれないと困る。だから、そこには$を付けない
→「$O6」のうち行を示す6には$が付いていないので、下にコピーすれば、Ｏ列７行目、８行目、９行目……とスライドしてくれる


（１）Excel全般について

▶行はヨコ、と列はタテ
　Excelでは横を行、縦を列とかカラムと呼んで区別している。

▶式は小文字で打とう
　Excelは、式を大文字で書いても小文字でも命令を聞いてくれる。なので、数式は小文字で入力するとよい。正しく認識されれば大文字に変換される。小文字のまま残ったら、どこかで打ち間違いをしているはず、と分かる。


（２）関数

▶当日使った関数

VLOOKUPの書式
=VLOOKUP(ア, イ, ウ, エ)
ア：ここに入っているのと同じものを
イ：この範囲の左端の列で探して、一致するものがあったら
ウ：その右にこれだけ行ったところのデータを取ってくる
エ：FALSE

※今回は、都道府県名の列から数えて２列目に取ってきたいデータが入っているので、ウは２
※エは常に「FALSE」で決め打ち。省略すると、予期せぬ動作をする
※アを探しに行く列は、イの左端でないとダメ。これがVLOOKUPの制約。そうなっていないときは、列の並びを変えるか、別の手を使う必要がある


SUBSTITUTEの書式
=SUBSTITUTE(ア, "イ", "ウ")
ア：このセルのうち
イ："ここに書いた文字"を
ウ："こちらの文字"に置き換える

※ウで、引用符の中に何も入れない（引用符を続けて２つ打つ）でおけば、イを見つけたら削除する、という動作になる
※重ねて使うときは、括弧の中から外へ、順に動作する。たとえば、
=SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(A2,"県",""),"府",""),"東京都","東京")
なら、A2セルの内容に「県」があればそれを削り、次に「府」を削り、「東京都」があれば単に「東京」としたもの、という意味。東京だけ面倒なことをしているのは、「都」を削る、という指示だと、京都府の「都」も削ってしまうため
※一度にやらずに、まず「県」を抜いた列を作る。それを元にして、隣の列に「『府』を抜いたものをここに」という数式を入れる、というふうに、順次やっていってもよい。そのほうが、間違いにくい
※別添のExcelファイルでは、SUBSTITUTEを２度使う代わりに、半角の文字が万が一入っていたら全角にして、全角空白を抜く、という書き方をしてみた。「JIS」という関数で全角にして、その後でSUBSTITUTEを一度だけ使っている。こういう方法もある、というご参考まで


VALUEの書式
=VALUE(ア)
ア：この文字列を数値に変換する

※セルの書式設定で「数値」を選んでうまくいくこともある。でも、これを使うと確実


▶知っておくと便利な関数
MAX     最大値を返す
MIN     最小値を返す
LARGE   大きい方から数えて指定の順位のものを返す。１位はMAXと同じ
SMALL   LARGEの逆
ASC     全角文字を半角に変換。反対はJIS
EXACT   ２つの文字列が等しいかどうか判定
FIND    ある文字列が他の文字列の中にあるか検索。SEARCHと似ているが、大文字と小文字を区別。ワイルドカードは使えない
JIS     半角文字を全角に変換。反対はASC
LEFT    文字列の左から、指定された字数を取り出す
LEN     文字列の字数が分かる
LOWER   英字を小文字に変換
MID     文字列の途中の指定の位置から、指定の字数の文字を取り出す
REPLACE 指定された位置の文字を他の文字に置き換える
RIGHT   文字列の右から、指定された字数を取り出す
SEARCH  ある文字列が他の文字列の中にあるか検索。FINDと違い、大文字と小文字は区別せず。ワイルドカードが使える
TRIM    前後の余分な空白を取り除く。途中の空白は１つだけ残す。とてもよく使う
UPPER   英字を大文字に変換


（３）相対参照と絶対参照

▶「F4」をうまく使おう
　セルの式をコピぺなどで増殖させると、気を利かして、計算対象の行や列をずらしてくれる。それが便利だからで、このデフォルトの動作を「相対参照」という。
　だが、困る場合もある。そのときは、ずらされては困るものに「$」マークをつけると、コピー先でもずれなくなる。これが「絶対参照」。式の入力中に｢F4｣キーを押すと、行と列の両方またはどちらかに、＄がついたり消えたりして切り替えられる。
　VLOOKUPの２番目の引き数である「探す範囲」は、絶対参照でないと、だんだんずれていってしまって困るはず。または、範囲に名前を付ける方法でもよい（Google検索してみて）。絶対参照と同じ動作になる。


（４）能率が上がるショートカットキー

▶Ctrl + ドラッグ
　シート名のタブをつかみながらだと、そのシートのコピーを作成

▶Shift + ドラッグ
　行や列を選択し、その境目をつかみながらだと、並び替え

▶Ctrl + 1
　セルの書式設定。エルではなくて数字の一（テンキーの1はダメ）

▶Ctrl + Z
　直前の変更を元に戻す

▶Ctrl + A
　表やシート全体を選択

▶Ctrl + C
　コピー

▶Ctrl + V
　通常の貼り付け。セル幅以外すべて引き継ぐ

▶Alt + Ctrl + V
　形式を選択して貼り付け。Ctrl + Vでは困るときに使う。関数を使って整形をした後、貼り直して「値だけ」にするのに便利（Vを選ぶ）

▶Alt + ;
　絞り込み時に表示されているセルだけをコピー元にする。重宝する

▶Ctrl + S
　ファイルを上書き保存

▶「F12」
　ファイルを別名で保存

▶「F2」
　セルの編集

▶Ctrl + F
　検索

▶Ctrl + H
　置換

▶Ctrl + カーソルキー
　空白セルは飛ばし、その次にデータの入っているセルにジャンプ

▶Ctrl + Home
　A1セル（左上）にジャンプ

▶Ctrl + End
　データの入っている最終セルにジャンプ

▶Ctrl + ;
　きょうの日付を入力。便利

▶Ctrl + :
　現在の時刻を入力。便利

▶Ctrl + *
　データが入っている範囲を選択。離れ小島は選択されない

▶Ctrl + T
　テーブルにする

▶Ctrl + Enter
　複数のセルに同じデータを入れる。一括して修正するときに便利

▶Alt + 下矢印
　そのカラムに入力済みのデータのリストから選ぶ


（５）昨年の資料

　なお、昨年の記者ゼミで散布図を作った回の資料が

https://github.com/nishioWU/JNPC

にあります。よろしければ、併せてご覧下さい。
　右上の緑の「Clone or download」のボタンから、ダウンロードして解凍して下さい。データ解凍用のパスワードが分からない方は、小生または事務局あてにお問い合わせ下さい。
　Excelのバージョンが最新でなくても、大丈夫です。土曜日のおさらいなら、Rのインストールは不要です。スライドの34ページあたりまでが、今回の範囲と重なります。ただし、地図化には触れていません。


---
　誤りの指摘、説明の足りない点のお問い合わせなど、ご遠慮なく西尾までお願いします。いただいたフィードバックを反映して改版します。
yoshito.nishio+JNPC@gmail.com

　　　　以上


